<!DOCTYPE html>
<html>
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
        <title>Page</title>
        <script>
            /*$(document).ready(function(){

            });*/
            
            var items = [];
            var portfolio = {
                name:"",
                code:"",
                marketValue:"",
                portfolioS: {
                className:"",
                classCode:"",
                classBaseFee:""}
            };
        
        
        function csvConvert(csv){
            var lines=csv.split("\r"); //seperates csv into lines
            var result = []; //creates the main array
            var headers=lines[0].split(","); //takes the first line which are the property names and splits each one after the ,

            for(var i=1;i<lines.length;i++){
                var obj = {}; //creates an array that will be put in the main array
                var currentline=lines[i].split(","); //splits up the line with each ,

                for(var j=0;j<headers.length;j++){
                    obj[headers[j]] = currentline[j]; //gets each value that was seperated by the , and assigns it
                    
                    if (obj[headers[j]]){ //if the item exists
                        obj[headers[j]] = obj[headers[j]].replace(/['"]+/g, ''); //Replaces "" with nothing
                        obj[headers[j]] = $.trim(obj[headers[j]]); //Trims first char if its a space
                     }
                }
                
                result.push(obj); //pushes the contents of the each object into result
            }
            return result; //returns the full array
        }

        function upload(file, fileNumber) {
            if(file.type.match(/text\/csv/)){ //checks if its a csv file
                oFReader = new FileReader(); //creates a file reader that asynchronously read the contents of files
                oFReader.readAsText(file); //reads contents of a file
                oFReader.onloadend = function() { //triggered each time the reading operation is completed (success or failure)
                    var object = csvConvert(this.result); //its gets the contents and assigns a variable to the object we created
                    dataLoaded(object, fileNumber); //displays message of sucess
                };
            } else {
                document.getElementById("output").innerHTML = "File  " + fileNumber + " failed to upload! Check the file type!";
            }
        }
        function insertIntoDataStructure (object, fileNumber){
            for (x in object){ //looping through
                if (fileNumber == 1){
                    if (object[x]['Portfolio Name']){ //if the item exists
                        portfolio.name = object[x]['Portfolio Name'];
                        portfolio.code = object[x]['Portfolio Code'];
                        portfolio.marketValue = object[x]['Portfolio Market Value'];
                        items.push(portfolio);
                        console.log(items[x]);
                    }
                }
                else {
                    console.log("else 2: " + items[x].name);
                    if (object[x]['Portfolio Name'] == items[x].name){ //if the item exists
                        console.log("file 2");
                        items[x].portfolioS.className = object[x]['Portfolio Name'];
                        //items[x].portfolio.portfolioS.code = object[x]['Portfolio Share Class Name'];
                        items[x].portfolioS.classCode = object[x]['Portfolio Share Class Code'];
                        items[x].portfolioS.classBaseFee = object[x]['Portfolio Share Class Base Fee'];
                        items.push(items);
                        console.log(items[x]);
                    }
                }
            }
            $("#text").autocomplete({
                source: portfolio.name,
                minLength: 2,
            });
            var name = "Amber State Capital Appreciation Fund";
            createTable(name);
        }
        function dataLoaded(object, fileNumber){
           var button = "button"+fileNumber;
           if (object){
               document.getElementById("output").innerHTML = "File " + fileNumber + " sucessfully uploaded!";
               document.getElementsByClassName(button)[0].innerHTML = "";
               insertIntoDataStructure(object, fileNumber);
           }
            else {
               document.getElementById("output").innerHTML = "File  " + fileNumber + " failed to upload!";
            }
        }
        function createTable(name){
            var table = document.getElementById('table');
            for (x in items) {
                console.log(items[x]);
                var tr = "<tr>";
                tr += "<td>" + items[x].name + "</td>";
                tr += "<td>" + items[x].code + "</td>";
                tr += "<td>" + items[x].marketValue + "</td>";
                tr += "<td>" + items[x].marketValue + "</td>";
                tr += "</tr>";
            }
            table.innerHTML += tr;
        }
        
        </script>
    </head>
    <body>
        <div class="button1">
            <button onclick="document.querySelector('#file1').click()">Select File 1</button>
            <input id="file1" style="visibility: hidden; width: 0px;" type="file" onchange="upload(this.files[0], 1)">
        </div>
        <div class="button2">
            <button onclick="document.querySelector('#file2').click()">Select File 2</button>
            <input id="file2" style="visibility: hidden; width: 0px;" type="file" onchange="upload(this.files[0], 2)">
        </div>
        
        <div id="output"></div>
        
        
        <div id="view" style="margin-top:50px;">
            <input type="text" id="text">
            <input type="submit" id="submit">


            <table id="table" style="width:75%; margin:auto; text-align:center; padding-top:25px;">
                <tr>
                    <th>Portfolio Name</th>
                    <th>Portfolio Share Class Name</th>
                    <th>Portfolio Share Class Code</th>
                    <th>Portfolio Share Class Base Fee</th>
                </tr>
                <!--<tr>
                    <td>Jill</td>
                    <td>Smith</td>
                    <td>50</td>
                    <td>50</td>
                </tr>
                <tr>
                    <td>Eve</td>
                    <td>Jackson</td>		
                    <td>94</td>
                    <td>50</td>
                </tr>
                <tr>
                    <td>John</td>
                    <td>Doe</td>		
                    <td>80</td>
                    <td>50</td>
                </tr>-->
            </table>
        </div>
    </body>
</html>