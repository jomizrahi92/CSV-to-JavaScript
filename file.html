<!DOCTYPE html>
<html>
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
        <title>Page</title>
        <script>
            $(document).ready(function(){
                $( "#text" ).autocomplete({
                   source: portfolio
                });

            });
            var items = [];
            var portfolio = {
                name:"Name",
                code:"AAAA",
                marketValue:"1234",
                portfolioS: {
                className:"Name",
                classCode:"AAAA",
                classBaseFee:"1234"}
            };
        
        
        //var csv is the CSV file with headers
        function csvJSON(csv){
            
            var lines=csv.split("\r");
            //console.log("lines: "+ lines);
            var result = [];
            var headers=lines[0].split(",");
            //console.log("headers: "+ headers);

            for(var i=1;i<lines.length;i++){
                
                var obj = {};
                var currentline=lines[i].split(",");
                //console.log("currentline: "+ currentline);

                for(var j=0;j<headers.length;j++){
                    obj[headers[j]] = currentline[j];
                    //console.log("headers[j]: "+headers[j]);
                    //console.log("obj[headers[j]]: "+ obj[headers[j]]);
                    
                    if (obj[headers[j]]){
                        //console.log("obj[headers[j]] OLD: "+ obj[headers[j]]);
                        obj[headers[j]] = obj[headers[j]].replace(/['"]+/g, '');
                        obj[headers[j]] = $.trim(obj[headers[j]]);
                        //console.log("obj[headers[j]] NEW: "+ obj[headers[j]]);
                        //console.log("TESTT: " + obj['Portfolio Market Value']);
                        //console.log("headers[j]: " + headers[j]);
                        if (headers[j] == "Portfolio Market Value"){
                           console.log("TEST");
                        }
                     }
                    /*if (headers[j] == "Portfolio Market Value"){
                        currentline[j] = currentline[j].replace(/['"]+/g, '');
                        console.log("its:" + currentline[j]);
                    }*/

                }
                
                result.push(obj);
                
            }
            return JSON.stringify(result);
        }

        function upload(file, fileNumber) {
            if( file.type.match(/text\/csv/) || file.type.match(/vnd\.ms-excel/) ){
                oFReader = new FileReader();
                oFReader.onloadend = function() {
                    
                    var json = csvJSON(this.result);

                    /*console.log(json);
                     
                    var blob = new Blob([json], {type: 'application/json'});
                    var url = URL.createObjectURL(blob);
                    var output = document.getElementById("output");
                    output.innerHTML = '<a href="'+url+'">JSON file</a>';
                     */
                    dataLoaded(json, fileNumber);
                    insertIntoDataStructure(json);
                };
                oFReader.readAsText(file);
            } else {
                document.getElementById("output").innerHTML = "File  " + fileNumber + " failed to upload!";
            }
        }
        function insertIntoDataStructure (json){
            var obj = JSON.parse(json);
            console.log(Object.keys(obj) + " and " + JSON.stringify(obj));
            //console.log(obj[1]['Portfolio Market Value']);
            for (x in obj){
                //console.log(obj.hasOwnProperty("Portfolio Market Value"));
                if (obj[x]['Portfolio Name']){
                    portfolio.name = obj[x]['Portfolio Name'];
                    portfolio.code = obj[x]['Portfolio Code'];
                    portfolio.marketValue = obj[x]['Portfolio Market Value'];
                    //console.log(obj[x]['Portfolio Market Value']);
                    /*portfolio.portfolioS.className = obj[x]['Portfolio Name'];
                    portfolio.portfolioS.className = obj[x]['Portfolio Name'];
                    portfolio.portfolioS.className = obj[x]['Portfolio Name'];*/
                    items.push(portfolio);
                    //console.log(obj[x]);
                    console.log(items[x]);
                }
            }
            //console.log(items[1]);
        }
        function dataLoaded(json, fileNumber){
           var button = "button"+fileNumber;
           if (json){
               document.getElementById("output").innerHTML = "File " + fileNumber + " sucessfully uploaded!";
               document.getElementsByClassName(button)[0].innerHTML = "";
           }
            else {
               document.getElementById("output").innerHTML = "File  " + fileNumber + " failed to upload!";
            }
        }
        
        </script>
    </head>
    <body>
        <div class="button1">
            <button onclick="document.querySelector('#file1').click()">Select File 1</button>
            <input id="file1" style="visibility: hidden; width: 0px;" type="file" onchange="upload(this.files[0], 1)">
        </div>
        <div class="button2">
            <button onclick="document.querySelector('#file2').click()">Select File 2</button>
            <input id="file2" style="visibility: hidden; width: 0px;" type="file" onchange="upload(this.files[0], 2)">
        </div>
        
        <div id="output"></div>
        
        
        <div id="view" style="margin-top:50px;">
            <input id="text">
            <input type="submit" id="submit">


            <table style="width:75%; margin:auto; text-align:center; padding-top:25px;">
                <tr>
                    <th>Portfolio Name</th>
                    <th>Portfolio Share Class Name</th>
                    <th>Portfolio Share Class Code</th>
                    <th>Portfolio Share Class Base Fee</th>
                </tr>
                <tr>
                    <td>Jill</td>
                    <td>Smith</td>
                    <td>50</td>
                    <td>50</td>
                </tr>
                <tr>
                    <td>Eve</td>
                    <td>Jackson</td>		
                    <td>94</td>
                    <td>50</td>
                </tr>
                <tr>
                    <td>John</td>
                    <td>Doe</td>		
                    <td>80</td>
                    <td>50</td>
                </tr>
            </table>
        </div>
    </body>
</html>